@inherits LayoutComponentBase
@using Front_BudgetApp.Services.SÃ©curitÃ©
@using Microsoft.AspNetCore.Components.Authorization


@inject BlazorBootstrap.ToastService ToastService
@inject NavigationManager Navigation
@inject AuthStateService AuthState

<AuthorizeView>
    <Authorized>
        <div class="app-container">
            @* ===== MOBILE MENU TOGGLE (CSS-only) ===== *@
            <input type="checkbox" id="sidebar-toggle" class="sidebar-toggle-input"/>
            <label for="sidebar-toggle" class="sidebar-backdrop"></label>

            @* ===== SIDEBAR GLASSMORPHISM ===== *@
            <aside class="sidebar glass-sidebar">
                <NavMenu/>
            </aside>

            @* ===== MAIN CONTENT ===== *@
            <div class="main-wrapper">
                @* ===== HEADER GLASSMORPHISM ===== *@
                <header class="app-header glass-header">
                    <div class="header-content">
                        @* Mobile menu toggle button *@
                        <label for="sidebar-toggle" class="mobile-menu-toggle">
                            <Icon Name="IconName.List"/>
                        </label>

                        <div class="header-title">
                            <Icon Name="IconName.Wallet2" Size="IconSize.x4" Class="header-icon"/>
                            <span>BudgetApp</span>
                        </div>
                        <div class="user-section d-flex">
                            <div class="user-info">
                                <Icon Name="IconName.PersonCircle" Size="IconSize.x3" />
                                <span class="user-name">@context.User.Identity?.Name</span>
                            </div>
                            <button class="logout-btn" @onclick="HandleLogout">
                                <Icon Name="IconName.BoxArrowRight" />
                                <span>DÃ©connexion</span>
                            </button>
                        </div>
                    </div>
                </header>

                @* ===== PAGE CONTENT ===== *@
                <main class="main-content">
                    <article class="content px-4">
                        @Body
                    </article>
                </main>
            </div>
        </div>

        <div id="blazor-error-ui">
            An unhandled error has occurred.
            <a href="" class="reload">Reload</a>
            <a class="dismiss">ðŸ—™</a>
        </div>

        <Toasts class="p-3"
                Placement="ToastsPlacement.BottomRight"
                AutoHide="true"
                Delay="4000"
                @rendermode="RenderMode.InteractiveServer"/>

    </Authorized>
    <NotAuthorized>
        <RedirectToLogin/>
    </NotAuthorized>
</AuthorizeView>

@code {
    private async Task HandleLogout()
    {
        await AuthState.LogoutAsync();

        Navigation.NavigateTo("/login", forceLoad: true);
    }
}

<style>


    .user-section {
        flex-direction: row;
        gap: 0.75rem;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .user-name {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .logout-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(220, 53, 69, 0.1);
        border: 1px solid rgba(220, 53, 69, 0.3);
        border-radius: var(--radius-md);
        color: #dc3545;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.85rem;
    }

    .logout-btn:hover {
        background: rgba(220, 53, 69, 0.2);
        border-color: rgba(220, 53, 69, 0.5);
    }
</style>
