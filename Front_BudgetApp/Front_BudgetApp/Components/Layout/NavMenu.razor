@using Front_BudgetApp.Services.Sécurité
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthStateService AuthState
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

@* ===== SIDEBAR HEADER ===== *@
<div class="sidebar-header">
    <div class="brand">
        <div class="brand-icon">
            <Icon Name="IconName.Wallet2" Size="IconSize.x3" />
        </div>
        <span class="brand-text">BudgetApp</span>
    </div>
</div>

@* ===== NAVIGATION ===== *@
<div class="nav-scrollable">
    <nav class="nav-menu">
        <div class="nav-section-title">Menu</div>

        <NavLink class="nav-item-glass" href="" Match="NavLinkMatch.All">
            <div class="nav-icon">
                <Icon Name="IconName.HouseDoor" />
            </div>
            <span class="nav-text">Tableau de bord</span>
        </NavLink>

        <NavLink class="nav-item-glass" href="depenses">
            <div class="nav-icon">
                <Icon Name="IconName.CashStack" />
            </div>
            <span class="nav-text">Budget</span>
        </NavLink>

        <NavLink class="nav-item-glass" href="categories">
            <div class="nav-icon">
                <Icon Name="IconName.Tags" />
            </div>
            <span class="nav-text">Catégories</span>
        </NavLink>
    </nav>
</div>

@* ===== USER SECTION ===== *@
<AuthorizeView>
    <Authorized>
        <div class="sidebar-footer">
            <div class="user-section">
                <div class="user-info">
                    <Icon Name="IconName.PersonCircle" Size="IconSize.x3" />
                    <span class="user-name">@context.User.Identity?.Name</span>
                </div>
                <button class="logout-btn" @onclick="HandleLogout">
                    <Icon Name="IconName.BoxArrowRight" />
                    <span>Déconnexion</span>
                </button>
            </div>
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private async Task HandleLogout()
    {
        await AuthState.LogoutAsync();

        if (AuthStateProvider is CustomAuthStateProvider customProvider)
        {
            customProvider.NotifyAuthStateChanged();
        }

        Navigation.NavigateTo("/login", forceLoad: true);
    }
}
